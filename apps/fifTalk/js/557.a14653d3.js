"use strict";(self["webpackChunkfifTalk"]=self["webpackChunkfifTalk"]||[]).push([[557],{14361:(o,t,e)=>{e.d(t,{Z:()=>W});var l=e(21073),a=e(18621);const n={class:"text-h6 text-weight-bold text-left text-uppercase"},i=(0,l._)("div",{id:"pay",style:{height:"230px"}},null,-1),s={class:"text-positive"};function d(o,t,e,d,r,c){const p=(0,l.up)("q-space"),u=(0,l.up)("q-btn"),m=(0,l.up)("q-card-section"),v=(0,l.up)("q-separator"),g=(0,l.up)("q-card-actions"),w=(0,l.up)("q-card"),b=(0,l.up)("q-dialog"),f=(0,l.Q2)("close-popup");return(0,l.wg)(),(0,l.j4)(b,{ref:"dialogRef",onHide:d.onDialogHide},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{class:"q-dialog-plugin"},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{class:"row items-center q-pb-none q-my-sm"},{default:(0,l.w5)((()=>[(0,l._)("div",n,(0,a.zw)(d.title),1),(0,l.Wm)(p),(0,l.wy)((0,l.Wm)(u,{icon:"close",flat:"",round:"",dense:"",onClick:d.onCancelClick},null,8,["onClick"]),[[f]])])),_:1}),(0,l.Wm)(v,{inset:""}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[i,(0,l._)("div",s,(0,a.zw)(d.message),1)])),_:1}),(0,l.Wm)(g,{align:"right"},{default:(0,l.w5)((()=>[(0,l.Wm)(u,{color:"primary",label:"OK",onClick:d.onOKClick},null,8,["onClick"]),(0,l.Wm)(u,{color:"primary",label:"Cancel",onClick:d.onCancelClick},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["onHide"])}e(50254);var r=e(45970);let c=null;const p={name:"PayDlg",props:{payData:Object},emits:[...r.Z.emits],setup(o){const{dialogRef:t,onDialogHide:e,onDialogOK:l,onDialogCancel:a}=(0,r.Z)();async function n(){c||(c=new Opay2,await c.init({containerID:"pay",debug:!0})),c.setUI({close:!1,border:"0px"}),nblib.setOpay(c);const t=o.payData,e=await nblib.getDomain(t.owner);if(e){const o=await e.writePublicDomain({domain:t.nbdomain,kv:t.kv,tags:"zzTalk1"});console.log("update result:",o),l(o)}}return n(),{title:"Pay to procceed",message:"OK",dialogRef:t,onDialogHide:e,onOKClick(){l("test")},onCancelClick:a}}};var u=e(55152),m=e(61769),v=e(87551),g=e(59116),w=e(72155),b=e(11783),f=e(27362),y=e(55095),k=e(92106),_=e(60046),q=e.n(_);const Z=(0,u.Z)(p,[["render",d]]),W=Z;q()(p,"components",{QDialog:m.Z,QCard:v.Z,QCardSection:g.Z,QSpace:w.Z,QBtn:b.Z,QSeparator:f.Z,QCardActions:y.Z}),q()(p,"directives",{ClosePopup:k.Z})},10557:(o,t,e)=>{e.r(t),e.d(t,{default:()=>Ao});var l=e(21073);const a={style:{"margin-top":"-24px"}},n={key:0},i={key:1};function s(o,t,e,s,d,r){const c=(0,l.up)("PostList"),p=(0,l.up)("PostView");return(0,l.wg)(),(0,l.iD)("div",a,[o.boardid?((0,l.wg)(),(0,l.iD)("div",n,[(0,l.Wm)(c,{boardid:o.boardid},null,8,["boardid"])])):(0,l.kq)("",!0),o.postid?((0,l.wg)(),(0,l.iD)("div",i,[(0,l.Wm)(p,{postid:o.postid},null,8,["postid"])])):(0,l.kq)("",!0)])}var d=e(20744),r=e(18621);const c={class:"q-pa-lg"},p={class:"text-h3 q-my-lg"},u={class:"bg-white q-pa-sm",style:{"min-width":"70%"}},m=(0,l.Uk)(" Compose Post ");function v(o,t,e,a,n,i){var s;const d=(0,l.up)("q-btn"),v=(0,l.up)("Avatar"),g=(0,l.up)("q-item-section"),w=(0,l.up)("q-item-label"),b=(0,l.up)("q-icon"),f=(0,l.up)("q-item"),y=(0,l.up)("q-list"),k=(0,l.up)("q-toolbar-title"),_=(0,l.up)("q-toolbar"),q=(0,l.up)("Composer"),Z=(0,l.up)("q-dialog"),W=(0,l.Q2)("ripple");return(0,l.wg)(),(0,l.iD)("div",c,[(0,l._)("div",p,[(0,l.Uk)((0,r.zw)(null===(s=a.board)||void 0===s?void 0:s.title)+" ",1),(0,l.Wm)(d,{round:"",flat:"",color:"primary",icon:"add",onClick:t[0]||(t[0]=o=>a.compose())}),(0,l.Wm)(d,{round:"",flat:"",color:"primary",icon:"refresh",onClick:t[1]||(t[1]=o=>a.refresh())}),(0,l.Wm)(d,{round:"",flat:"",color:"primary",icon:"more_vert"})]),(0,l._)("div",null,[(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.posts,(o=>((0,l.wg)(),(0,l.iD)("div",{key:o.postid},[(0,l.wy)(((0,l.wg)(),(0,l.j4)(f,{to:"/post/"+o.postid,clickable:""},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{avatar:"",top:""},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{account:o.author},null,8,["account"])])),_:2},1024),(0,l.Wm)(g,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,r.zw)(o.title),1)])),_:2},1024),(0,l.Wm)(w,{caption:"",lines:"3"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,r.zw)(o.content),1)])),_:2},1024)])),_:2},1024),(0,l.Wm)(g,{side:""},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{class:"rol",color:"yellow",name:"comment",style:{"font-size":"24px"},left:""})])),_:1}),(0,l.Wm)(g,{side:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,r.zw)(o.count?o.count:0),1)])),_:2},1024)])),_:2},1032,["to"])),[[W]])])))),128))])),_:1})]),(0,l.Wm)(Z,{modelValue:a.dialog,"onUpdate:modelValue":t[4]||(t[4]=o=>a.dialog=o),position:"bottom",persistent:""},{default:(0,l.w5)((()=>[(0,l._)("div",u,[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Wm)(k,null,{default:(0,l.w5)((()=>[m])),_:1}),(0,l.Wm)(d,{flat:"",round:"",dense:"",icon:"close",onClick:t[2]||(t[2]=o=>a.dialog=!1)})])),_:1}),(0,l.Wm)(q,{boardid:a.board.boardid,onCloseDialog:t[3]||(t[3]=o=>a.dialog=!1)},null,8,["boardid"])])])),_:1},8,["modelValue"])])}var g=e(55034);const w={class:"bg-white"},b={class:"row"},f={class:"row justify-end"};function y(o,t,e,a,n,i){const s=(0,l.up)("q-select"),d=(0,l.up)("q-input"),r=(0,l.up)("VueMarkdownEditor"),c=(0,l.up)("q-btn");return(0,l.wg)(),(0,l.iD)("div",w,[(0,l._)("div",b,[(0,l.Wm)(s,{modelValue:a.selAccount,"onUpdate:modelValue":t[0]||(t[0]=o=>a.selAccount=o),label:"Account",options:a.accounts,class:"col-3"},null,8,["modelValue","options"]),(0,l.Wm)(d,{modelValue:a.title,"onUpdate:modelValue":t[1]||(t[1]=o=>a.title=o),placeholder:"Title",class:"col-9",readonly:!!a.props.parent},null,8,["modelValue","readonly"])]),(0,l._)("div",f,[(0,l.Wm)(r,{modelValue:a.content,"onUpdate:modelValue":t[2]||(t[2]=o=>a.content=o),height:"400px",mode:"edit"},null,8,["modelValue"]),(0,l.Wm)(c,{color:"primary",icon:"mail",label:"Submit",class:"q-mt-md",onClick:a.onSubmit},null,8,["onClick"])])])}var k=e(69125),_=e.n(k),q=e(5958),Z=e.n(q),W=e(74604),C=e(94868),D=e.n(C),h=e(14361),P=e(82398),Q=e(57011),H=e(14716);_().use(Z(),{Prism:D()}),_().lang.use("en-US",W.Z);const V={name:"Composer",components:{VueMarkdownEditor:_()},props:{boardid:String,parent:String,title:String},emits:["closeDialog","success"],setup(o,{emit:t}){(0,d.iH)(!1);const e=(0,d.iH)(Q.vc.lastAccount),l=(0,d.iH)(Q.vc.accounts),a=(0,d.iH)(o.title),n=(0,d.iH)("");const i=(0,P.Z)();function s(){t("closeDialog","someValue"),Opay2.loginPopup({},(o=>{console.log(o),0==o.code&&l.value.push(o.domain)}))}return{props:o,title:a,selAccount:e,accounts:l,content:n,login:s,async onSubmit(){t("closeDialog","someValue"),console.log(a.value,n.value,e.value),Q.vc.lastAccount=e.value;const l=o.boardid,s=o.parent,d=l.split("."),r=d[1]+"."+d[2],c={},p=await g.r.inst().dbGetBoard(o.boardid);let u=a.value,m=n.value;p.password&&(u=await H.Z.encryptData(u,p.password),m=await H.Z.encryptData(m,p.password)),c[d[0]]={command:"newPost",data:{title:u,content:m,boardid:o.boardid,author:e.value,time:Math.floor(Date.now()/1e3)}},s&&(c[d[0]].data.parent=s),c.toDomain=r;const v={type:"keyUpdate",owner:e.value,nbdomain:r,kv:c};i.dialog({component:h.Z,componentProps:{payData:v}}).onOk((o=>{console.log(o),0==o.code&&(c[d[0]].data.title=a.value,c[d[0]].data.content=n.value,g.r.inst().fire(Q._E.postPaid,{postid:o.txid,...c[d[0]].data}),t("success",""))}))}}}};var S=e(55152),x=e(39424),U=e(53791),A=e(11783),I=e(60046),z=e.n(I);const R=(0,S.Z)(V,[["render",y]]),O=R;z()(V,"components",{QSelect:x.Z,QInput:U.Z,QBtn:A.Z});const T={key:0},B=["src"],L={key:1};function j(o,t,e,a,n,i){const s=(0,l.up)("q-avatar");return(0,l.wg)(),(0,l.iD)("div",null,[a.avatarURL?((0,l.wg)(),(0,l.iD)("div",T,[(0,l.Wm)(s,null,{default:(0,l.w5)((()=>[(0,l._)("img",{src:a.avatarURL},null,8,B)])),_:1})])):((0,l.wg)(),(0,l.iD)("div",L,[(0,l.Wm)(s,{color:"teal","text-color":"white"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,r.zw)(a.props.account[0]),1)])),_:1})]))])}const K={name:"Avatar",props:{account:String},setup(o){const t=(0,d.iH)(null);async function e(e){const l=await g.r.inst().api.getAvatar(o.account);l&&(t.value=l)}return e(o.account),{getAvatar:e,avatarURL:t,props:o}}};var E=e(25838);const M=(0,S.Z)(K,[["render",j]]),G=M;z()(K,"components",{QAvatar:E.Z});const Y={name:"PostList",components:{Composer:O,Avatar:G},props:{boardid:String},setup(o){const t=(0,d.iH)({}),e=(0,d.iH)({}),a=(0,d.iH)(!1);(0,P.Z)();async function n(){e.value=await g.r.inst().dbGetBoard(o.boardid),console.log(e.value),t.value=await g.r.inst().dbGetPosts({boardid:o.boardid}),console.log(t)}function i(){a.value=!0}function s(){g.r.inst().refreshBoard(o.boardid),n()}return g.r.inst().sub(Q._E.postAdded,(o=>{n()})),(0,l.YP)((()=>o.boardid),n),n(),{board:e,posts:t,dialog:a,compose:i,refresh:s}}};var N=e(65532),F=e(87440),J=e(60272),X=e(6984),$=e(56731),oo=e(61769),to=e(16829),eo=e(75428),lo=e(72789);const ao=(0,S.Z)(Y,[["render",v]]),no=ao;z()(Y,"components",{QBtn:A.Z,QList:N.Z,QItem:F.Z,QItemSection:J.Z,QItemLabel:X.Z,QIcon:$.Z,QDialog:oo.Z,QToolbar:to.Z,QToolbarTitle:eo.Z}),z()(Y,"directives",{Ripple:lo.Z});const io={class:"bg-grey-4 q-pa-lg"},so={class:"discussion-stream q-ma-lg"},ro={class:"post-steam q-pt-md q-pl-lg q-pr-sm q-mb-sm"};function co(o,t,e,a,n,i){const s=(0,l.up)("PostItem");return(0,l.wg)(),(0,l.iD)("div",io,[(0,l._)("div",so,[(0,l._)("div",ro,[(0,l.Wm)(s,{postid:o.props.postid},null,8,["postid"])])])])}const po={key:0},uo={class:"post-content postItem",style:{"padding-left":"80px","margin-top":"-40px"}},mo={key:0,class:"text-h4 q-mb-md text-red"},vo={class:"replyBar"},go=(0,l.Uk)("Reply"),wo={class:"bg-white q-pa-sm",style:{"min-width":"70%"}},bo=(0,l.Uk)(" Compose Post ");function fo(o,t,e,a,n,i){var s,d,c,p;const u=(0,l.up)("Avatar"),m=(0,l.up)("VMdPreview"),v=(0,l.up)("q-btn"),g=(0,l.up)("q-separator"),w=(0,l.up)("PostItem",!0),b=(0,l.up)("q-toolbar-title"),f=(0,l.up)("q-toolbar"),y=(0,l.up)("Composer"),k=(0,l.up)("q-dialog");return a.post?((0,l.wg)(),(0,l.iD)("div",po,[(0,l._)("div",{class:(0,r.C_)(["post-item bg-white q-ma-sm q-pa-md",{replyPost:a.level>=2}])},[(0,l.Wm)(u,{account:null===(s=a.post)||void 0===s?void 0:s.author},null,8,["account"]),(0,l._)("div",uo,[(0,l._)("div",null,(0,r.zw)(null===(d=a.post)||void 0===d?void 0:d.author),1),0==a.level?((0,l.wg)(),(0,l.iD)("div",mo,(0,r.zw)(null===(c=a.post)||void 0===c?void 0:c.title),1)):(0,l.kq)("",!0),(0,l.Wm)(m,{text:null===(p=a.post)||void 0===p?void 0:p.content},null,8,["text"]),(0,l._)("div",vo,[(0,l.Wm)(v,{flat:"",dense:"",icon:"reply",onClick:t[0]||(t[0]=o=>a.onReply(a.post.postid,a.post.content))},{default:(0,l.w5)((()=>[go])),_:1})])]),0==a.level?((0,l.wg)(),(0,l.j4)(g,{key:0})):(0,l.kq)("",!0)],2),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.post.children,(o=>((0,l.wg)(),(0,l.iD)("div",{key:o.postid},[(0,l.Wm)(w,{postid:o.postid,parentid:a.post.postid,level:a.level+1},null,8,["postid","parentid","level"])])))),128)),(0,l.Wm)(k,{modelValue:a.dialog,"onUpdate:modelValue":t[3]||(t[3]=o=>a.dialog=o),position:"bottom",persistent:""},{default:(0,l.w5)((()=>[(0,l._)("div",wo,[(0,l.Wm)(f,null,{default:(0,l.w5)((()=>[(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[bo])),_:1}),(0,l.Wm)(v,{flat:"",round:"",dense:"",icon:"close",onClick:t[1]||(t[1]=o=>a.dialog=!1)})])),_:1}),(0,l.Wm)(y,{boardid:a.post.boardid,parent:a.reply_parentid,title:a.reply_title,onSuccess:a.onComposeSuccess,onCloseDialog:t[2]||(t[2]=o=>a.dialog=!1)},null,8,["boardid","parent","title","onSuccess"])])])),_:1},8,["modelValue"])])):(0,l.kq)("",!0)}var yo=e(69874),ko=e.n(yo),_o=e(95601),qo=e.n(_o),Zo=e(6358),Wo=e.n(Zo);ko().use(qo(),{Hljs:Wo()});const Co={name:"PostItem",components:{VMdPreview:ko(),Composer:O,Avatar:G},props:{parentid:String,postid:String,level:Number},setup(o){const t=(0,d.iH)(null),e=(0,d.iH)("# header"),l=(0,d.iH)(!1),a=(0,d.iH)(""),n=(0,d.iH)(""),i=(0,d.iH)(0);async function s(){t.value=await g.r.inst().dbGetPost(o.postid),console.log("got post id:",o.postid,t.value)}return i.value=o.level?o.level:0,console.log("level:",i.value),g.r.inst().sub("Post_Added",(o=>{console.log("in postItem:",o),s()})),s(),{props:o,level:i,post:t,src:e,dialog:l,reply_parentid:a,reply_title:n,onComposeSuccess(o){},onReply(o,t){t.length>20&&(t=t.slice(0,20)),t="RE:"+t,a.value=o,l.value=!0,n.value=t}}}};var Do=e(27362);const ho=(0,S.Z)(Co,[["render",fo],["__scopeId","data-v-75f6560a"]]),Po=ho;z()(Co,"components",{QBtn:A.Z,QSeparator:Do.Z,QDialog:oo.Z,QToolbar:to.Z,QToolbarTitle:eo.Z});const Qo=(0,l.aZ)({name:"PostView",components:{PostItem:Po},props:{postid:String},setup(o){return{props:o}}}),Ho=(0,S.Z)(Qo,[["render",co]]),Vo=Ho;var So=e(40200);const xo=(0,l.aZ)({name:"PageIndex",components:{PostList:no,PostView:Vo},setup(){const o=(0,So.yj)(),t=(0,d.iH)(o.params.boardid),e=(0,d.iH)(o.params.postid);return(0,l.YP)((()=>o.params),(()=>{t.value=o.params.boardid,e.value=o.params.postid})),{boardid:t,postid:e}}}),Uo=(0,S.Z)(xo,[["render",s]]),Ao=Uo}}]);